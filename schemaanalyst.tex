\newcommand{\mx}[1]{\mathbf{\bm{#1}}} % Matrix command
\newcommand{\vc}[1]{\mathbf{\bm{#1}}} % Vector command

% Define the layers to draw the diagram
\pgfdeclarelayer{background}
\pgfdeclarelayer{foreground}
\pgfsetlayers{background,main,foreground}

% Define distances for bordering
\def\blockdist{3.5}
\def\vertdist{2}

\begin{tikzpicture}[thick,scale=.75, every node/.style={scale=.75}]
    \node (sa) [proc]  {\textit{SchemaAnalyst}};

    \path (sa.west)+(-\blockdist,1.0*\vertdist) node (cc)[io] {Coverage Criterion};
    \path (sa.west)+(-\blockdist,0.0*\vertdist) node (dg)[io] {Data Generator};

    \path (sa.west)+(-\blockdist,-1.0*\vertdist) node (ds) [io] {Database Schema};

    \path (sa.east)+(0.75*\blockdist,0*\vertdist) node (ts) [io] {Test Suite};


% 
%     \path (asr1.west)+(-\blockdist,0.0*\vertdist) node (doubler) [proc] {Schema Doubler};
% 
%         \path (asr2.west)+(-2.65*\blockdist-.12,-0.0*\vertdist) node (criteriona)
%         [io] {Coverage Criterion};
%         \path (dots.west)+(-2.65*\blockdist-.12,-0.0*\vertdist) node (dataa) [io] {Data Generator};
%     \path (doubler.west)+(-\blockdist,-0.0*\vertdist) node (doublera) [io] {Doubler Choice};
%     \path (doubler.west)+(-\blockdist,-1.0*\vertdist) node (schemaa) [io] {Database Schema};
% 
% 
%     \path [draw, ->] (doubler.east) -- node [above] {}
%         (asr1.180);

    \path [draw, ->] (ds.east) -- node [above] {}
        (sa.185);
    \path [draw, ->] (cc.east) -- node [above] {}
        (sa.175);
    \path [draw, ->] (dg.east) -- node [above] {}
        (sa.180);
    \path [draw, ->] (sa.east) -- node [above] {}
        (ts.west);
% 
%     \path [draw, ->] (doublera.east) -- node [above] {}
%         (doubler.west);
%     \path [draw, ->] (dataa.east) -- node [above] {}
%         (dots.west);
%     \path [draw, ->] (criteriona.east) -- node [above] {}
%         (asr2.west);
%     \path [draw, ->] (schemaa.east) -| node [above] {}
%         (doubler.230);
% 
%     \path (vote.east)+(\blockdist,0*\vertdist) node (runtime) [io] {Runtime Records};
%     \path [draw,->] (vote.east)+(0.3,0) -- node [above]{}
%         (runtime.west);
%     \path (runtime.east)+(\blockdist,0*\vertdist) node (runtimeo) [io] {Runtime Records};
% 
% 
%      \path (vote.east)+(\blockdist,-3.165*\vertdist) node (convalg) [proc] {Converge Algorithm};
%      \path [draw,->] (runtime.south) -- node [above]{}
%         (convalg.north);
%      \path [draw,->] (convalg.west) -| node [above,pos=.25]{Continue Experiment}
%         (doubler.290);
% 
%         \path [draw,->] (runtime.east) -- node [above]{}
%         (runtimeo);


    % \path (ds.east) +(\blockdist,0) node (asrs) {\textit{SchemaAnalyst}};

    % \path (asrs.south) +(0,-1.6) node (singleexp) {\textsc{ExpOse}};

    % \begin{pgfonlayer}{background}
    %     \path (doubler.west |- asr2.north)+(-0.3,0.6) node (a) {};
    %     \path (wa.south -| runtime.east)+(+0.3,-0.6) node (b) {};
    %     \path (runtime.east |- singleexp.east)+(+0.3,-0.3) node (c) {};

    %     \path[fill=kapfhammerDarkGrey,rounded corners, draw=black!50, dashed]
    %         (a) rectangle (c);
    %     \path (asr1.north west)+(-0.2,0.2) node (a) {};

    % \end{pgfonlayer}

    \begin{pgfonlayer}{background}
        \path (cc.west |- cc.north)+(-0.3,0.3) node (a) {};
        \path (sa.south -| sa.east)+(+0.3,-0.3) node (b) {};
        \path (ts.east |- ds.east)+(+0.3,-0.5) node (c) {};

        \path[fill=kapfhammerDarkGrey,rounded corners, draw=black!50, dashed]
            (a) rectangle (c);

        \path (ds.north west)+(-0.2,0.2) node (a) {};

    \end{pgfonlayer}



\end{tikzpicture}
